@using Patient.Application.Account
@using Patient.Domain.Repositories

@inject UserManager<Patient.Domain.Entities.Actors.Doctor> _doctorManager

@inject IHttpContextAccessor httpContextAccesor
@inject IReportRepository _reportRepository
@inject IPrescriptionRequestRepository _prescriptionRequestRepository
@inject NavigationManager _navigationManager


<div class="container px-4">
    <h3>Podsumowanie</h3>
    <div class="row position-relative">
        <div class="col">           
            <MudPaper Class="pa-4 ma-2 summary-item" Elevation="3" Style="cursor: pointer;" @onclick='() => RedirectTo("raporty")'>
                <h4>Nowe raporty</h4>
                <h4>@reportsNumber</h4>
            </MudPaper>
           
        </div>
        <div class="col">
            <MudPaper Class="pa-4 ma-2 summary-item" Elevation="3" Style="cursor: pointer;" @onclick='() => RedirectTo("recepty")'>
                <h4>Prośby o wystawienie recepty</h4>
                <h4>@prescriptionRequestsNumber</h4>
            </MudPaper>
        </div>
        <div class="col">
            <MudPaper Class="pa-4 ma-2 summary-item" Elevation="3" Style="cursor: pointer;" @onclick='() => RedirectTo("wiadomosci")'>
                Wiadomosci
            </MudPaper>
        </div>

        <div class="col">
            <MudPaper Class="pa-4 ma-2 summary-item" Elevation="3" Style="cursor: pointer;" @onclick='() => RedirectTo("pacjenci")'>
                
            </MudPaper>
        </div>
    </div>
</div>




@code {


    private Patient.Domain.Entities.Actors.Doctor doctor = new();

    private int reportsNumber;
    private int prescriptionRequestsNumber;

    protected override async Task OnInitializedAsync()
    {

        doctor = await _doctorManager.GetUserAsync(httpContextAccesor.HttpContext.User);
        reportsNumber = await _reportRepository.GetDoctorReportsNumber(doctor);
        prescriptionRequestsNumber = await _prescriptionRequestRepository.CountDoctorsPrescriptionRequests(doctor.Id);

    }

    private void RedirectTo(string path)
    {
        _navigationManager.NavigateTo($"/lekarz/{path}");
    }

   
}
